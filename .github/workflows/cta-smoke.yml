name: CTA Smoke Tests

on:
  pull_request:
    paths:
      - "src/**"
      - "tests/**"
      - "package.json"
      - "pnpm-lock.yaml"
      - "yarn.lock"
      - "package-lock.json"
  workflow_dispatch: {}

jobs:
  smoke-test:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: "20" }
      - name: Install deps & build
        run: |
          if [ -f pnpm-lock.yaml ]; then npm i -g pnpm && pnpm i && pnpm build;
          elif [ -f yarn.lock ]; then yarn install --frozen-lockfile && yarn build;
          else npm ci && npm run build; fi
      - name: Run CTA smoke tests
        run: |
          npx playwright install --with-deps
          npx playwright test tests/cta-smoke.spec.ts
